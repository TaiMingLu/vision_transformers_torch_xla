W&B online run started. URL: https://wandb.ai/ttl/tpu-vit/runs/ncb2c1l1
TPU mode: Using num_workers=0 to avoid pickle issues, will use MpDeviceLoader for parallelism
Mixup is activated!
WARNING:timm.models._builder:No pretrained configuration specified for my_vit_b model. Using a default. Please add a config to the model pretrained_cfg registry or pass explicitly.
Forcing XLA synchronization after model.to(device)...
XLA mark_step() after model.to(device) completed
Forcing XLA synchronization before parameter counting...
XLA mark_step() completed
TPU spawned process: world_size = 64
Calculated total_batch_size = 16384
Number of training examples = 1281167
LR = 0.00400000
Batch size = 16384
Update frequent = 1
Number of training steps per epoch = 78
TPU multihost mode: XLA handles data distribution internally
About to create optimizer...
TPU mode: Using name-only parameter grouping to avoid XLA compilation
TPU mode: Collecting parameter names...
TPU mode: Found 152 trainable parameters
TPU mode: Grouping parameters by names...
Processing parameter 1/152: cls_token
Processing parameter 51/152: blocks.3.mlp.fc2.weight
Processing parameter 101/152: blocks.8.norm1.weight
Processing parameter 151/152: head.weight
TPU mode: Parameter names grouped successfully
TPU mode: Mapping names to tensors...
TPU mode: All 152 parameters mapped successfully
Parameter iteration completed! Processed 152 parameters.
TPU mode: Created 2 parameter groups, returning optimizer groups...
Parameter groups created successfully
Optimizer created successfully
TPU mode: Skipping loss scaler (XLA handles mixed precision)
TPU mode: About to set loss_scaler = None...
TPU mode: Loss scaler set to None
About to create Cosine LR scheduler...
Set warmup steps = 1560
LR scheduler created successfully
About to continue to weight decay scheduler...
About to check args.weight_decay_end...
Directly setting weight_decay_end to avoid freeze...
weight_decay_end set to: 0.05
About to call cosine_scheduler for weight decay...
Calling with: wd=0.05, wd_end=0.05, epochs=100, steps_per_epoch=78
Set warmup steps = 0
cosine_scheduler completed, about to calculate min/max...
Weight decay schedule created: 0.05 -> 0.05
About to create criterion...
Created SoftTargetCrossEntropy criterion
criterion = SoftTargetCrossEntropy()
TPU mode: Skipping warmup (caused shape errors), will compile on first iteration
About to call auto_load_model...
auto_load_model completed
About to define get_eval_model helper function...
get_eval_model function defined
About to set max_accuracy...
max_accuracy initialized
ğŸš€ Creating MpDeviceLoader for training DataLoader (TPU optimization)...
âœ… Training MpDeviceLoader created successfully
ğŸš€ Creating MpDeviceLoader for validation DataLoader (TPU optimization)...
âœ… Validation MpDeviceLoader created successfully
Start training for 100 epochs
About to record start_time...
About to enter training loop...
Starting epoch 0...
Setting sampler epoch...
About to call original_train_sampler.set_epoch(0)...
âœ… original_train_sampler.set_epoch(0) completed in 0.00s
Setting wandb steps...
About to call train_one_epoch...
About to zero_grad optimizer...
About to start data loader loop...
About to call enumerate(metric_logger.log_every(...))...
ğŸ“Š First enumerate() call took 233.75s
ğŸš€ Starting data_iter_step 0 (DataLoader iteration took 0.000s)...
Epoch: [0]  [ 0/78]  eta: 5:56:59  loss: 7.0938 (7.0938)  lr: 0.0000 (0.0000)  time: 274.6057  data: 233.7451
ğŸš€ Starting data_iter_step 1 (DataLoader iteration took 19.332s)...
ğŸš€ Starting data_iter_step 2 (DataLoader iteration took 12.542s)...
ğŸš€ Starting data_iter_step 3 (DataLoader iteration took 0.289s)...
ğŸš€ Starting data_iter_step 4 (DataLoader iteration took 0.268s)...
ğŸš€ Starting data_iter_step 5 (DataLoader iteration took 0.234s)...
ğŸš€ Starting data_iter_step 6 (DataLoader iteration took 0.421s)...
ğŸš€ Starting data_iter_step 7 (DataLoader iteration took 0.316s)...
ğŸš€ Starting data_iter_step 8 (DataLoader iteration took 1.086s)...
ğŸš€ Starting data_iter_step 9 (DataLoader iteration took 0.313s)...
ğŸš€ Starting data_iter_step 10 (DataLoader iteration took 0.641s)...
Epoch: [0]  [10/78]  eta: 0:32:54  loss: 7.0312 (7.0455)  lr: 0.0000 (0.0000)  time: 29.0400  data: 21.2500
ğŸš€ Starting data_iter_step 11 (DataLoader iteration took 0.391s)...
ğŸš€ Starting data_iter_step 12 (DataLoader iteration took 0.327s)...
ğŸš€ Starting data_iter_step 13 (DataLoader iteration took 0.327s)...
ğŸš€ Starting data_iter_step 14 (DataLoader iteration took 0.626s)...
ğŸš€ Starting data_iter_step 15 (DataLoader iteration took 0.617s)...
ğŸš€ Starting data_iter_step 16 (DataLoader iteration took 0.279s)...
ğŸš€ Starting data_iter_step 17 (DataLoader iteration took 0.600s)...
ğŸš€ Starting data_iter_step 18 (DataLoader iteration took 0.174s)...
ğŸš€ Starting data_iter_step 19 (DataLoader iteration took 0.325s)...
ğŸš€ Starting data_iter_step 20 (DataLoader iteration took 0.671s)...
Epoch: [0]  [20/78]  eta: 0:15:07  loss: 7.0312 (7.0387)  lr: 0.0000 (0.0000)  time: 2.6958  data: 0.0006
ğŸš€ Starting data_iter_step 21 (DataLoader iteration took 0.384s)...
ğŸš€ Starting data_iter_step 22 (DataLoader iteration took 0.633s)...
ğŸš€ Starting data_iter_step 23 (DataLoader iteration took 0.648s)...
ğŸš€ Starting data_iter_step 24 (DataLoader iteration took 0.226s)...
ğŸš€ Starting data_iter_step 25 (DataLoader iteration took 0.576s)...
ğŸš€ Starting data_iter_step 26 (DataLoader iteration took 0.622s)...
ğŸš€ Starting data_iter_step 27 (DataLoader iteration took 0.645s)...
ğŸš€ Starting data_iter_step 28 (DataLoader iteration took 0.296s)...
ğŸš€ Starting data_iter_step 29 (DataLoader iteration took 0.297s)...
ğŸš€ Starting data_iter_step 30 (DataLoader iteration took 0.610s)...
Epoch: [0]  [30/78]  eta: 0:08:42  loss: 7.0312 (7.0363)  lr: 0.0001 (0.0000)  time: 0.9082  data: 0.0006
ğŸš€ Starting data_iter_step 31 (DataLoader iteration took 0.659s)...
ğŸš€ Starting data_iter_step 32 (DataLoader iteration took 0.595s)...
ğŸš€ Starting data_iter_step 33 (DataLoader iteration took 0.604s)...
ğŸš€ Starting data_iter_step 34 (DataLoader iteration took 0.659s)...
ğŸš€ Starting data_iter_step 35 (DataLoader iteration took 0.605s)...
ğŸš€ Starting data_iter_step 36 (DataLoader iteration took 0.254s)...
ğŸš€ Starting data_iter_step 37 (DataLoader iteration took 0.709s)...
ğŸš€ Starting data_iter_step 38 (DataLoader iteration took 0.228s)...
ğŸš€ Starting data_iter_step 39 (DataLoader iteration took 0.618s)...
ğŸš€ Starting data_iter_step 40 (DataLoader iteration took 0.277s)...
Epoch: [0]  [40/78]  eta: 0:05:21  loss: 7.0312 (7.0282)  lr: 0.0001 (0.0001)  time: 0.8978  data: 0.0005
ğŸš€ Starting data_iter_step 41 (DataLoader iteration took 0.251s)...
ğŸš€ Starting data_iter_step 42 (DataLoader iteration took 0.599s)...
ğŸš€ Starting data_iter_step 43 (DataLoader iteration took 0.280s)...
ğŸš€ Starting data_iter_step 44 (DataLoader iteration took 0.595s)...
ğŸš€ Starting data_iter_step 45 (DataLoader iteration took 0.351s)...
ğŸš€ Starting data_iter_step 46 (DataLoader iteration took 0.282s)...
ğŸš€ Starting data_iter_step 47 (DataLoader iteration took 0.192s)...
ğŸš€ Starting data_iter_step 48 (DataLoader iteration took 0.678s)...
ğŸš€ Starting data_iter_step 49 (DataLoader iteration took 0.705s)...
ğŸš€ Starting data_iter_step 50 (DataLoader iteration took 0.279s)...
Epoch: [0]  [50/78]  eta: 0:03:15  loss: 7.0000 (7.0233)  lr: 0.0001 (0.0001)  time: 0.8930  data: 0.0005
ğŸš€ Starting data_iter_step 51 (DataLoader iteration took 0.617s)...
ğŸš€ Starting data_iter_step 52 (DataLoader iteration took 0.275s)...
ğŸš€ Starting data_iter_step 53 (DataLoader iteration took 0.271s)...
ğŸš€ Starting data_iter_step 54 (DataLoader iteration took 0.594s)...
ğŸš€ Starting data_iter_step 55 (DataLoader iteration took 0.646s)...
ğŸš€ Starting data_iter_step 56 (DataLoader iteration took 4.151s)...
ğŸš€ Starting data_iter_step 57 (DataLoader iteration took 1.796s)...
ğŸš€ Starting data_iter_step 58 (DataLoader iteration took 0.691s)...
ğŸš€ Starting data_iter_step 59 (DataLoader iteration took 0.670s)...
ğŸš€ Starting data_iter_step 60 (DataLoader iteration took 0.367s)...
Epoch: [0]  [60/78]  eta: 0:01:49  loss: 7.0000 (7.0169)  lr: 0.0001 (0.0001)  time: 1.1675  data: 0.1993
ğŸš€ Starting data_iter_step 61 (DataLoader iteration took 0.682s)...
ğŸš€ Starting data_iter_step 62 (DataLoader iteration took 0.592s)...
ğŸš€ Starting data_iter_step 63 (DataLoader iteration took 0.623s)...
ğŸš€ Starting data_iter_step 64 (DataLoader iteration took 4.555s)...
ğŸš€ Starting data_iter_step 65 (DataLoader iteration took 1.500s)...
ğŸš€ Starting data_iter_step 66 (DataLoader iteration took 0.329s)...
ğŸš€ Starting data_iter_step 67 (DataLoader iteration took 0.627s)...
ğŸš€ Starting data_iter_step 68 (DataLoader iteration took 0.637s)...
ğŸš€ Starting data_iter_step 69 (DataLoader iteration took 0.626s)...
ğŸš€ Starting data_iter_step 70 (DataLoader iteration took 0.600s)...
Epoch: [0]  [70/78]  eta: 0:00:43  loss: 6.9688 (7.0119)  lr: 0.0002 (0.0001)  time: 1.4206  data: 0.3962
ğŸš€ Starting data_iter_step 71 (DataLoader iteration took 0.270s)...
ğŸš€ Starting data_iter_step 72 (DataLoader iteration took 1.509s)...
ğŸš€ Starting data_iter_step 73 (DataLoader iteration took 1.931s)...
ğŸš€ Starting data_iter_step 74 (DataLoader iteration took 0.644s)...
ğŸš€ Starting data_iter_step 75 (DataLoader iteration took 0.585s)...
ğŸš€ Starting data_iter_step 76 (DataLoader iteration took 0.357s)...
ğŸš€ Starting data_iter_step 77 (DataLoader iteration took 0.620s)...
Epoch: [0]  [77/78]  eta: 0:00:05  loss: 6.9688 (7.0076)  lr: 0.0002 (0.0001)  time: 1.2609  data: 0.2423
Epoch: [0] Total time: 0:06:32 (5.0285 s / it)
Averaged stats: loss: 6.9688 (7.0256)  lr: 0.0002 (0.0001)
Done train_one_epoch...
Checking checkpoint save conditions...
About to start validation...
Getting eval model...
About to call evaluate()...
Starting validation loop...
Validation DataLoader type: <class 'torch_xla.distributed.parallel_loader.MpDeviceLoader'>
Validation DataLoader batch count: 3
Test:  [0/3]  eta: 0:05:07  loss: 6.9688 (6.9688)  acc1: 0.2598 (0.2598)  acc5: 0.7812 (0.7812)  time: 102.4489  data: 93.6250
Test:  [2/3]  eta: 0:00:37  loss: 6.9062 (6.9271)  acc1: 0.2598 (0.2551)  acc5: 0.7812 (0.8939)  time: 37.0639  data: 31.2554
Test: Total time: 0:01:51 (37.0803 s / it)
* Acc@1 0.194 Acc@5 0.796 loss 6.917
Done evaluate()...
Accuracy of the model on the 50000 test images: 0.2%
Synchronizing XLA before checkpoint save...
XLA synchronization completed
Building checkpoint dictionary...
Getting model state_dict...
Getting optimizer state_dict...
Basic checkpoint dict created
About to call save_on_master for /home/terry/models/vanilla/b-vanilla/checkpoint-best.pth...
Moving checkpoint tensors to CPU for saving...
Tensors moved to CPU, starting torch.save...
