W&B online run started. URL: https://wandb.ai/ttl/tpu-vit/runs/4d3toi3k
Mixup is activated!
WARNING:timm.models._builder:No pretrained configuration specified for my_vit_b model. Using a default. Please add a config to the model pretrained_cfg registry or pass explicitly.
Forcing XLA synchronization after model.to(device)...
XLA mark_step() after model.to(device) completed
Forcing XLA synchronization before parameter counting...
XLA mark_step() completed
TPU spawned process: world_size = 32
Calculated total_batch_size = 4096
Number of training examples = 1281167
LR = 0.00400000
Batch size = 4096
Update frequent = 1
Number of training steps per epoch = 312
TPU multihost mode: XLA handles data distribution internally
About to create optimizer...
TPU mode: About to call xm.mark_step() before parameter iteration...
TPU mode: xm.mark_step() completed
TPU mode: Using name-only parameter grouping to avoid XLA compilation
TPU mode: Collecting parameter names...
TPU mode: Found 152 trainable parameters
TPU mode: Grouping parameters by names...
Processing parameter 1/152: cls_token
Processing parameter 51/152: blocks.3.mlp.fc2.weight
Processing parameter 101/152: blocks.8.norm1.weight
Processing parameter 151/152: head.weight
TPU mode: Parameter names grouped successfully
TPU mode: Mapping names to tensors...
TPU mode: All 152 parameters mapped successfully
Parameter iteration completed! Processed 152 parameters.
TPU mode: Final XLA synchronization...
TPU mode: Final mark_step() completed
About to print param groups...
TPU mode: Skipping detailed param group printing to avoid XLA issues
Created 2 parameter groups
  - no_decay: 102 parameters
  - decay: 50 parameters
About to return parameter groups...
Parameter groups created successfully
Optimizer created successfully
TPU mode: Skipping loss scaler (XLA handles mixed precision)
TPU mode: About to set loss_scaler = None...
TPU mode: Loss scaler set to None
About to create Cosine LR scheduler...
Set warmup steps = 6240
LR scheduler created successfully
Set warmup steps = 0
Max WD = 0.0500000, Min WD = 0.0500000
criterion = SoftTargetCrossEntropy()
TPU mode: Skipping warmup (caused shape errors), will compile on first iteration
Start training for 100 epochs
TPU mode: Processing iteration 0, step 0, samples shape: torch.Size([128, 3, 224, 224])
TPU mode: Starting XLA step for iteration 0...
TPU mode: Current device = xla:0, device type = xla
TPU mode: samples.device = xla:0
TPU mode: targets.device = xla:0
TPU mode: model device = xla:0
TPU mode: Iteration 0 completed in 47.90s
TPU mode: Iteration 0, TPU memory: {'bytes_used': 1089165312, 'bytes_limit': 34088157184}
Epoch: [0]  [  0/312]  eta: 5:27:55  loss: 6.9688 (6.9688)  lr: 0.0000 (0.0000)  time: 63.0639  data: 9.6864
TPU mode: Starting XLA step for iteration 1...
TPU mode: Iteration 1 completed in 45.89s
TPU mode: Starting XLA step for iteration 2...
TPU mode: Iteration 2 completed in 0.46s
TPU mode: Starting XLA step for iteration 3...
TPU mode: Iteration 3 completed in 0.56s
TPU mode: Starting XLA step for iteration 4...
TPU mode: Iteration 4 completed in 0.47s
TPU mode: Starting XLA step for iteration 5...
TPU mode: Starting XLA step for iteration 6...
TPU mode: Starting XLA step for iteration 7...
TPU mode: Starting XLA step for iteration 8...
TPU mode: Starting XLA step for iteration 9...
TPU mode: Starting XLA step for iteration 10...
Epoch: [0]  [ 10/312]  eta: 2:28:56  loss: 7.0312 (7.0483)  lr: 0.0000 (0.0000)  time: 29.5905  data: 18.2393
TPU mode: Starting XLA step for iteration 11...
TPU mode: Starting XLA step for iteration 12...
TPU mode: Starting XLA step for iteration 13...
TPU mode: Starting XLA step for iteration 14...
TPU mode: Starting XLA step for iteration 15...
TPU mode: Starting XLA step for iteration 16...
TPU mode: Starting XLA step for iteration 17...
TPU mode: Starting XLA step for iteration 18...
TPU mode: Starting XLA step for iteration 19...
TPU mode: Starting XLA step for iteration 20...
Epoch: [0]  [ 20/312]  eta: 2:03:32  loss: 7.0625 (7.0610)  lr: 0.0000 (0.0000)  time: 23.5026  data: 18.7843
TPU mode: Starting XLA step for iteration 21...
TPU mode: Starting XLA step for iteration 22...
TPU mode: Starting XLA step for iteration 23...
TPU mode: Starting XLA step for iteration 24...
TPU mode: Starting XLA step for iteration 25...
TPU mode: Starting XLA step for iteration 26...
TPU mode: Starting XLA step for iteration 27...
TPU mode: Starting XLA step for iteration 28...
TPU mode: Starting XLA step for iteration 29...
TPU mode: Starting XLA step for iteration 30...
Epoch: [0]  [ 30/312]  eta: 1:52:17  loss: 7.0312 (7.0514)  lr: 0.0000 (0.0000)  time: 20.7589  data: 18.2035
TPU mode: Starting XLA step for iteration 31...
TPU mode: Starting XLA step for iteration 32...
TPU mode: Starting XLA step for iteration 33...
TPU mode: Starting XLA step for iteration 34...
TPU mode: Starting XLA step for iteration 35...
TPU mode: Starting XLA step for iteration 36...
TPU mode: Starting XLA step for iteration 37...
TPU mode: Starting XLA step for iteration 38...
TPU mode: Starting XLA step for iteration 39...
TPU mode: Starting XLA step for iteration 40...
Epoch: [0]  [ 40/312]  eta: 1:44:44  loss: 7.0312 (7.0541)  lr: 0.0000 (0.0000)  time: 20.7115  data: 17.7909
TPU mode: Starting XLA step for iteration 41...
TPU mode: Starting XLA step for iteration 42...
TPU mode: Starting XLA step for iteration 43...
TPU mode: Starting XLA step for iteration 44...
TPU mode: Starting XLA step for iteration 45...
TPU mode: Starting XLA step for iteration 46...
TPU mode: Starting XLA step for iteration 47...
TPU mode: Starting XLA step for iteration 48...
TPU mode: Starting XLA step for iteration 49...
TPU mode: Processing iteration 50, step 50, samples shape: torch.Size([128, 3, 224, 224])
TPU mode: Starting XLA step for iteration 50...
TPU mode: Iteration 50, TPU memory: {'bytes_used': 1278269952, 'bytes_limit': 34088157184}
Epoch: [0]  [ 50/312]  eta: 1:38:42  loss: 7.0625 (7.0527)  lr: 0.0000 (0.0000)  time: 20.6137  data: 17.6167
TPU mode: Starting XLA step for iteration 51...
TPU mode: Starting XLA step for iteration 52...
TPU mode: Starting XLA step for iteration 53...
TPU mode: Starting XLA step for iteration 54...
TPU mode: Starting XLA step for iteration 55...
TPU mode: Starting XLA step for iteration 56...
TPU mode: Starting XLA step for iteration 57...
TPU mode: Starting XLA step for iteration 58...
TPU mode: Starting XLA step for iteration 59...
TPU mode: Starting XLA step for iteration 60...
Epoch: [0]  [ 60/312]  eta: 1:33:38  loss: 7.0312 (7.0482)  lr: 0.0000 (0.0000)  time: 20.6343  data: 17.6887
TPU mode: Starting XLA step for iteration 61...
TPU mode: Starting XLA step for iteration 62...
TPU mode: Starting XLA step for iteration 63...
TPU mode: Starting XLA step for iteration 64...
TPU mode: Starting XLA step for iteration 65...
TPU mode: Starting XLA step for iteration 66...
TPU mode: Starting XLA step for iteration 67...
TPU mode: Starting XLA step for iteration 68...
TPU mode: Starting XLA step for iteration 69...
TPU mode: Starting XLA step for iteration 70...
Epoch: [0]  [ 70/312]  eta: 1:29:00  loss: 7.0312 (7.0458)  lr: 0.0000 (0.0000)  time: 20.6916  data: 17.7476
TPU mode: Starting XLA step for iteration 71...
TPU mode: Starting XLA step for iteration 72...
TPU mode: Starting XLA step for iteration 73...
TPU mode: Starting XLA step for iteration 74...
TPU mode: Starting XLA step for iteration 75...
TPU mode: Starting XLA step for iteration 76...
TPU mode: Starting XLA step for iteration 77...
TPU mode: Starting XLA step for iteration 78...
TPU mode: Starting XLA step for iteration 79...
TPU mode: Starting XLA step for iteration 80...
Epoch: [0]  [ 80/312]  eta: 1:24:35  loss: 7.0312 (7.0436)  lr: 0.0000 (0.0000)  time: 20.5966  data: 17.6111
TPU mode: Starting XLA step for iteration 81...
TPU mode: Starting XLA step for iteration 82...
TPU mode: Starting XLA step for iteration 83...
TPU mode: Starting XLA step for iteration 84...
TPU mode: Starting XLA step for iteration 85...
TPU mode: Starting XLA step for iteration 86...
TPU mode: Starting XLA step for iteration 87...
TPU mode: Starting XLA step for iteration 88...
TPU mode: Starting XLA step for iteration 89...
TPU mode: Starting XLA step for iteration 90...
Epoch: [0]  [ 90/312]  eta: 1:20:16  loss: 7.0312 (7.0440)  lr: 0.0001 (0.0000)  time: 20.3705  data: 17.4251
TPU mode: Starting XLA step for iteration 91...
TPU mode: Starting XLA step for iteration 92...
TPU mode: Starting XLA step for iteration 93...
TPU mode: Starting XLA step for iteration 94...
TPU mode: Starting XLA step for iteration 95...
TPU mode: Starting XLA step for iteration 96...
TPU mode: Starting XLA step for iteration 97...
TPU mode: Starting XLA step for iteration 98...
TPU mode: Starting XLA step for iteration 99...
TPU mode: Processing iteration 100, step 100, samples shape: torch.Size([128, 3, 224, 224])
TPU mode: Starting XLA step for iteration 100...
TPU mode: Iteration 100, TPU memory: {'bytes_used': 1278269952, 'bytes_limit': 34088157184}
Epoch: [0]  [100/312]  eta: 1:16:13  loss: 7.0312 (7.0393)  lr: 0.0001 (0.0000)  time: 20.3417  data: 17.2030
TPU mode: Starting XLA step for iteration 101...
TPU mode: Starting XLA step for iteration 102...
TPU mode: Starting XLA step for iteration 103...
TPU mode: Starting XLA step for iteration 104...
TPU mode: Starting XLA step for iteration 105...
TPU mode: Starting XLA step for iteration 106...
TPU mode: Starting XLA step for iteration 107...
TPU mode: Starting XLA step for iteration 108...
TPU mode: Starting XLA step for iteration 109...
TPU mode: Starting XLA step for iteration 110...
Epoch: [0]  [110/312]  eta: 1:12:11  loss: 7.0000 (7.0366)  lr: 0.0001 (0.0000)  time: 20.2992  data: 17.1459
TPU mode: Starting XLA step for iteration 111...
TPU mode: Starting XLA step for iteration 112...
TPU mode: Starting XLA step for iteration 113...
TPU mode: Starting XLA step for iteration 114...
TPU mode: Starting XLA step for iteration 115...
TPU mode: Starting XLA step for iteration 116...
TPU mode: Starting XLA step for iteration 117...
TPU mode: Starting XLA step for iteration 118...
TPU mode: Starting XLA step for iteration 119...
TPU mode: Starting XLA step for iteration 120...
Epoch: [0]  [120/312]  eta: 1:08:16  loss: 7.0000 (7.0336)  lr: 0.0001 (0.0000)  time: 20.1410  data: 17.6276
TPU mode: Starting XLA step for iteration 121...
TPU mode: Starting XLA step for iteration 122...
TPU mode: Starting XLA step for iteration 123...
TPU mode: Starting XLA step for iteration 124...
TPU mode: Starting XLA step for iteration 125...
TPU mode: Starting XLA step for iteration 126...
TPU mode: Starting XLA step for iteration 127...
TPU mode: Starting XLA step for iteration 128...
TPU mode: Starting XLA step for iteration 129...
TPU mode: Starting XLA step for iteration 130...
Epoch: [0]  [130/312]  eta: 1:04:25  loss: 7.0000 (7.0315)  lr: 0.0001 (0.0000)  time: 20.1103  data: 17.8154
TPU mode: Starting XLA step for iteration 131...
TPU mode: Starting XLA step for iteration 132...
TPU mode: Starting XLA step for iteration 133...
TPU mode: Starting XLA step for iteration 134...
TPU mode: Starting XLA step for iteration 135...
TPU mode: Starting XLA step for iteration 136...
TPU mode: Starting XLA step for iteration 137...
TPU mode: Starting XLA step for iteration 138...
TPU mode: Starting XLA step for iteration 139...
TPU mode: Starting XLA step for iteration 140...
Epoch: [0]  [140/312]  eta: 1:00:39  loss: 6.9688 (7.0286)  lr: 0.0001 (0.0000)  time: 20.0908  data: 17.7495
TPU mode: Starting XLA step for iteration 141...
TPU mode: Starting XLA step for iteration 142...
TPU mode: Starting XLA step for iteration 143...
TPU mode: Starting XLA step for iteration 144...
TPU mode: Starting XLA step for iteration 145...
TPU mode: Starting XLA step for iteration 146...
TPU mode: Starting XLA step for iteration 147...
TPU mode: Starting XLA step for iteration 148...
TPU mode: Starting XLA step for iteration 149...
TPU mode: Processing iteration 150, step 150, samples shape: torch.Size([128, 3, 224, 224])
TPU mode: Starting XLA step for iteration 150...
TPU mode: Iteration 150, TPU memory: {'bytes_used': 1278269952, 'bytes_limit': 34088157184}
Epoch: [0]  [150/312]  eta: 0:56:55  loss: 6.9688 (7.0255)  lr: 0.0001 (0.0000)  time: 20.0400  data: 17.6930
TPU mode: Starting XLA step for iteration 151...
TPU mode: Starting XLA step for iteration 152...
TPU mode: Starting XLA step for iteration 153...
TPU mode: Starting XLA step for iteration 154...
TPU mode: Starting XLA step for iteration 155...
TPU mode: Starting XLA step for iteration 156...
